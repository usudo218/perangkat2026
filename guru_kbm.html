<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PERANGKAT PEMBELAJARAN SMAN 1 MUNCAR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // Cek apakah yang masuk adalah Guru atau Siswa
        const role = localStorage.getItem('user_role');
        const siswa = localStorage.getItem('siswa_nama');

        // Jika BUKAN Guru DAN BUKAN Siswa, maka tendang ke login
        if (role !== 'guru' && !siswa) {
            alert("âš ï¸ Akses Ditolak: Harap Login Terlebih Dahulu!");
            window.location.href = 'index.html';
        }

        // Jika GURU yang masuk, kita buat data dummy agar sistem tidak error
        if (role === 'guru') {
            if (!localStorage.getItem('siswa_nama')) {
                localStorage.setItem('siswa_nama', 'PAK GURU');
                localStorage.setItem('siswa_kelas', 'RUANG GURU');
            }
        }
    </script>

    <style>
        :root { --primary: #0056b3; --bg: #f4f6f9; --white: #ffffff; --border: #ced4da; --h: #d4edda; --ht: #155724; --s: #fff3cd; --st: #856404; --i: #cce5ff; --it: #004085; --a: #f8d7da; --at: #721c24; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 0; margin: 0; color: #333; display: flex; flex-direction: column; min-height: 100vh; }
        
        /* TOMBOL KEMBALI KE DASHBOARD GURU */
        .btn-back-dashboard { 
            position: fixed; bottom: 20px; right: 20px; 
            background: #2563eb; color: white; 
            padding: 12px 20px; border-radius: 50px; 
            text-decoration: none; font-weight: bold; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); 
            z-index: 9999;
            transition: 0.3s;
        }
        .btn-back-dashboard:hover { background: #1d4ed8; transform: translateY(-2px); }

        /* CONTAINER & HEADER */
        .container { max-width: 1250px; margin: 20px auto; background: var(--white); border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.1); overflow: hidden; flex: 1; width: 95%; }
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; }
        .header h1 { margin: 0; font-size: 1.5rem; } .header p { margin: 5px 0 0; font-size: 0.9rem; opacity: 0.9; }
        
        /* NAVIGASI */
        .kelas-bar { background: #e9ecef; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .kelas-selector select { padding: 8px 12px; font-size: 1rem; border: 1px solid #aaa; border-radius: 4px; font-weight: bold; }
        .tabs { display: flex; background: #dee2e6; overflow-x: auto; }
        .tab-btn { flex: 1; min-width: 100px; padding: 12px; border: none; background: transparent; cursor: pointer; font-weight: 600; color: #495057; transition: 0.3s; border-bottom: 3px solid transparent; white-space: nowrap; }
        .tab-btn:hover { background: #ced4da; }
        .tab-btn.active { background: var(--white); color: var(--primary); border-bottom: 3px solid var(--primary); }
        .tab-content { padding: 20px; display: none; }
        .tab-content.active { display: block; }

        /* TOOLS & TABLE */
        .toolbar { display: flex; gap: 15px; margin-bottom: 15px; background: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid var(--border); flex-wrap: wrap; align-items: center; }
        .table-wrap { overflow-x: auto; width: 100%; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; min-width: 800px; }
        th, td { padding: 8px; border: 1px solid #dee2e6; text-align: left; vertical-align: top; }
        th { background-color: #f1f3f5; font-weight: bold; text-align: center; vertical-align: middle; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        
        /* UTILS */
        .hidden { display: none; }
        .btn { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; margin-right:5px; }
        .btn-green { background: #28a745; } .btn-print { background: #6c757d; } .btn-blue { background: #007bff; } .btn-red { background: #dc3545; }
        .footer { background: #343a40; color: #adb5bd; text-align: center; padding: 20px; font-size: 0.85rem; margin-top: auto; border-top: 4px solid var(--primary); }

        /* JURNAL INPUT */
        .jurnal-form { display: flex; flex-direction: column; gap: 15px; max-width: 800px; margin: 0 auto; }
        .form-group label { font-weight: bold; display: block; margin-bottom: 5px; }
        .form-group textarea, .form-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-family: inherit; }
        .form-group textarea { height: 100px; resize: vertical; }

        /* GRID MATERI */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .card-materi { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; text-align: center; transition: 0.3s; cursor: pointer; text-decoration: none; color: #333; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 150px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card-materi:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-color: var(--primary); }
        .card-icon { font-size: 3rem; margin-bottom: 10px; }
        .card-title { font-weight: bold; font-size: 1rem; }
        .section-title { border-bottom: 2px solid #ddd; padding-bottom: 5px; margin-top: 30px; margin-bottom: 15px; color: var(--primary); }

        /* PRINT STYLE (PENTING) */
        @media print { 
            .header, .kelas-bar, .tabs, .toolbar, #tab-setting, .footer, .btn-back-dashboard { display: none !important; } 
            .container { box-shadow: none; max-width: 100% !important; margin: 0 !important; width: 100%; padding: 0; } 
            .table-wrap { overflow: visible; } 
            
            /* TABEL HITAM TEGAS */
            table { width: 100%; border: 2px solid #000; border-collapse: collapse; font-size: 10pt; } 
            th, td { border: 1px solid #000 !important; color: #000; padding: 5px; }
            th { background-color: #eee !important; -webkit-print-color-adjust: exact; }
            
            /* HEADER CETAK */
            .print-header { display: block !important; margin-bottom: 20px; text-align: center; border-bottom: 3px double #000; padding-bottom: 10px; }
            .ph-title { font-size: 14pt; font-weight: bold; text-transform: uppercase; }
            .ph-sub { font-size: 11pt; }

            /* FOOTER TANDA TANGAN */
            .signature-block { display: block !important; margin-top: 30px; float: right; width: 250px; text-align: center; page-break-inside: avoid; }
            
            /* JIKA CETAK JURNAL -> LANDSCAPE */
            @page { margin: 1.5cm; }
        } 
        .print-header, .signature-block { display: none; }
        
        /* STYLE KHUSUS */
        .bg-h { background: var(--h); } .bg-s { background: var(--s); } .bg-i { background: var(--i); } .bg-a { background: var(--a); }
        input.input-nilai { width: 40px; text-align: center; } input.input-header { width: 90%; text-align: center; }
        .text-center { text-align: center; } .text-bold { font-weight: bold; }
    </style>
</head>
<body>

<a href="guru_dashboard.html" class="btn-back-dashboard">â¬…ï¸ Menu Guru</a>

<div class="container">
    <div class="header"><h1>PERANGKAT PEMBELAJARAN SMAN 1 MUNCAR<br/>SEMESTER GENAP TAHUN 2025/2026</h1><p>Sistem Informasi Pencatatan Jurnal Kegiatan Belajar Mengajar Digital</p></div>
    
    <div class="kelas-bar">
        <div class="kelas-selector"><label>ğŸ“‚ Pilih Kelas: </label><select id="pilih-kelas" onchange="gantiKelas()"><option value="">-- Pilih --</option></select></div>
        <strong id="info-kelas" style="color:#555;"></strong>
    </div>
    
    <div class="tabs">
        <button class="tab-btn active" onclick="bukaTab('presensi')">ğŸ“… Presensi</button>
        <button class="tab-btn" onclick="bukaTab('jurnal')">ğŸ“– Jurnal Mengajar</button>
        <button class="tab-btn" onclick="bukaTab('nilai')">ğŸ“ Input Nilai</button>
        <button class="tab-btn" onclick="bukaTab('materi')">ğŸ“š Materi & Tugas</button>
        <button class="tab-btn" onclick="bukaTab('rekap')">ğŸ“Š Rekap</button>
        <button class="tab-btn" onclick="bukaTab('setting')">â˜ï¸ Cloud Sync</button>
    </div>

    <div id="tab-presensi" class="tab-content active">
        <div class="toolbar">
            <div><label>Tanggal:</label><br><input type="date" id="tgl-harian" onchange="gantiKelas()" style="padding:6px; border:1px solid #ccc; border-radius:4px;"></div>
            <div><label><strong>Pertemuan Ke:</strong></label><br><select id="pertemuan-ke" onchange="simpanJurnal()" style="padding:6px; width:80px; border:1px solid #ccc; border-radius:4px; font-weight:bold;"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option></select></div>
        </div>
        <div class="table-wrap"><table id="tabel-presensi"><thead><tr><th width="5%">No</th><th>Nama Siswa</th><th width="20%">Status Kehadiran</th><th width="25%">Keterangan</th></tr></thead><tbody id="body-presensi"></tbody></table><div id="msg-empty" class="hidden" style="text-align:center; padding:20px; color:#888;">Silakan Pilih Kelas Terlebih Dahulu</div></div>
    </div>

    <div id="tab-jurnal" class="tab-content">
        <h3 style="text-align:center; color:var(--primary); border-bottom:2px solid #ddd; padding-bottom:10px;">JURNAL KEGIATAN BELAJAR MENGAJAR</h3>
        <p style="text-align:center; color:#666; margin-bottom:20px;">Isi jurnal untuk tanggal: <strong id="lbl-tgl-jurnal"></strong></p>
        <div class="jurnal-form">
            <div class="form-group"><label>Materi / Topik Pembelajaran:</label><textarea id="jurnal-materi" placeholder="Isi materi..." onchange="simpanJurnalGuru()"></textarea></div>
            <div class="form-group"><label>Aktivitas / Metode:</label><input type="text" id="jurnal-aktivitas" placeholder="Metode..." onchange="simpanJurnalGuru()"></div>
            <div class="form-group"><label>Catatan / Kendala:</label><textarea id="jurnal-catatan" placeholder="Catatan..." onchange="simpanJurnalGuru()"></textarea></div>
            <div style="text-align:right; font-size:0.9rem; color:green;" id="status-jurnal"></div>
        </div>
    </div>

    <div id="tab-nilai" class="tab-content">
        <p style="font-size:0.9rem; color:#666;"><i>Tips: Ketik nama materi tugas di kotak putih di bawah "Tugas X" agar tidak tertukar.</i></p>
        <div class="table-wrap"><table><thead><tr><th rowspan="2" width="30px">No</th><th rowspan="2" style="min-width:200px;">Nama Siswa</th><th colspan="5">TUGAS HARIAN</th><th colspan="2">ULANGAN</th><th rowspan="2" width="50px">UTS</th><th rowspan="2" width="50px">UAS</th><th rowspan="2" width="50px">RATA</th></tr><tr><th width="60px">T1<br><input class="input-header" id="info-t1" onchange="simpanInfoTugas('t1',this.value)"></th><th width="60px">T2<br><input class="input-header" id="info-t2" onchange="simpanInfoTugas('t2',this.value)"></th><th width="60px">T3<br><input class="input-header" id="info-t3" onchange="simpanInfoTugas('t3',this.value)"></th><th width="60px">T4<br><input class="input-header" id="info-t4" onchange="simpanInfoTugas('t4',this.value)"></th><th width="60px">T5<br><input class="input-header" id="info-t5" onchange="simpanInfoTugas('t5',this.value)"></th><th width="50px">UH1</th><th width="50px">UH2</th></tr></thead><tbody id="body-nilai"></tbody></table></div>
    </div>

    <div id="tab-materi" class="tab-content">
        <p style="background:#fff3cd; padding:10px; border:1px solid #ffeeba; border-radius:5px;">â„¹ï¸ <strong>Info:</strong> Klik pada kartu untuk membuka folder/file di Google Drive.</p>
        <h3 class="section-title">ğŸ“‚ Modul Ajar Informatika</h3>
        <div class="grid-container">
            <a href="#" onclick="alert('Link belum dipasang')" class="card-materi"><div class="card-icon">ğŸ“˜</div><div class="card-title">Modul Semester 1</div></a>
            <a href="#" onclick="alert('Link belum dipasang')" class="card-materi"><div class="card-icon">ğŸ“™</div><div class="card-title">Modul Semester 2</div></a>
        </div>
        <h3 class="section-title">ğŸ“ Tugas & Proyek</h3>
        <div class="grid-container">
            <a href="#" onclick="alert('Link belum dipasang')" class="card-materi"><div class="card-icon">ğŸ“‚</div><div class="card-title">Bank Soal</div></a>
        </div>
    </div>

    <div id="tab-rekap" class="tab-content">
        <div class="toolbar">
            <label>Mode:</label>
            <select id="mode-rekap" onchange="toggleRekap()" style="padding:8px; font-weight:bold;">
                <option value="bulanan">ğŸ—“ Rekap Presensi (Matriks)</option>
                <option value="harian">ğŸ“† Rekap Presensi (Harian)</option>
                <option value="nilai">ğŸ“ Rekap Nilai (Semester)</option>
                <option value="jurnal">ğŸ“– Rekap Jurnal Mengajar</option>
            </select>
            
            <div id="filter-wrapper"
